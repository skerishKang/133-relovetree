<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Relovetree - 나의 덕질 기록 | K-pop 팬을 위한 타임라인</title>
    <meta name="description" content="당신이 사랑하는 아티스트의 모든 순간을 타임라인으로 기록해보세요. BTS, 세븐틴, 스키즈 등의 러브트리를 만들고 관리하세요.">
    <meta name="keywords" content="러브트리, 덕질, K-pop, 타임라인, 팬앱, BTS, 세븐틴, 스키즈">
    <meta name="author" content="skerishKang">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Relovetree - 나의 덕질 기록">
    <meta property="og:description" content="사랑하는 아티스트의 모든 순간을 타임라인으로 기록해보세요">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="https://img.youtube.com/vi/gwMa6gpoE9I/hqdefault.jpg">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Relovetree - 나의 덕질 기록">
    <meta name="twitter:description" content="사랑하는 아티스트의 모든 순간을 타임라인으로 기록해보세요">
    <meta name="twitter:image" content="https://img.youtube.com/vi/gwMa6gpoE9I/hqdefault.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f43f5e'%3E%3Cpath d='M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z'/%3E%3C/svg%3E">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts with display=swap for performance -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS (Built locally for production) -->
    <link rel="stylesheet" href="output.css">

    <!-- Toss Payments SDK -->
    <script src="https://js.tosspayments.com/v1/payment"></script>

    <!-- Critical CSS for performance -->
    <style>
        /* Critical styles for above-the-fold content */
        :root {
            /* 
             * [배경 이미지 변경하는 곳]
             * 아래 url(...) 안에 원하는 이미지 주소를 넣으세요.
             * 데스크탑과 모바일 모두 이 이미지가 적용됩니다.
             */
            --main-bg-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=2073&auto=format&fit=crop');
        }

        body {
            background-color: #f8fafc;
            /* 배경 이미지 공통 적용 */
            background-image: var(--main-bg-image);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;

            font-display: swap;
        }

        /* 전체 페이지에서 가로 스크롤 방지 */
        html,
        body {
            overflow-x: hidden;
        }

        .loading-skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Dialog styles */
        dialog::backdrop {
            background: rgba(0, 0, 0, 0.5);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        dialog {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Custom scrollbar with better performance */
        @supports (scrollbar-width: thin) {
            .custom-scrollbar {
                scrollbar-width: thin;
                scrollbar-color: #cbd5e1 transparent;
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Line clamp utilities */
        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
            line-clamp: 1;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            line-clamp: 2;
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Responsive text sizing */
        @media (max-width: 640px) {
            .text-responsive-lg {
                font-size: 1.5rem;
                line-height: 2rem;
            }

            .text-responsive-xl {
                font-size: 1.75rem;
                line-height: 2.25rem;
            }
        }

        @media (min-width: 641px) {
            .text-responsive-lg {
                font-size: 1.875rem;
                line-height: 2.25rem;
            }

            .text-responsive-xl {
                font-size: 2.25rem;
                line-height: 2.5rem;
            }
        }

        /* Desktop/Mobile 프리뷰용 래퍼 공통 스타일 */
        #mobile-shell {
            flex: 1;
            width: 100%;
        }

        #mobile-shell-inner {
            width: 100%;
            height: 100%;
        }

        /* 모바일 프리뷰 모드에서 글래스모피즘 카드 + 외부 배경 */
        body.mobile-preview {
            /* body에 이미 적용된 배경 이미지를 그대로 사용하되, 필요시 오버레이 등을 추가할 수 있음 */
            /* 배경 설정은 위 body 블록에서 통합 관리됨 */
        }

        body.mobile-preview #mobile-shell {
            display: flex;
            justify-content: center;
            align-items: center;
            /* 중앙 정렬 */
            padding: 32px 0;
            min-height: 100vh;
            /* 화면 전체 높이 사용 */
        }

        body.mobile-preview #mobile-shell-inner {
            position: relative;
            /* 최신 아이폰 (iPhone 15/16 Pro) 크기 참조: 393px width */
            width: 393px;
            height: 852px;
            /* iPhone 15 Pro height */
            max-width: calc(100vw - 32px);
            max-height: calc(100vh - 64px);

            /* 테두리 및 둥근 모서리 (아이폰 스타일) */
            border-radius: 55px;
            border: 8px solid rgba(255, 255, 255, 0.4);
            /* 프레임 느낌 */

            /* 글래스모피즘 효과 */
            background: rgba(255, 255, 255, 0.25);
            /* 내부 반투명 */
            -webkit-backdrop-filter: blur(25px);
            backdrop-filter: blur(25px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(255, 255, 255, 0.2);

            padding: 20px 16px 30px;
            overflow: hidden;
            /* 내부 스크롤이 프레임을 넘지 않도록 */

            /* 1번 요청: 내부 스크롤 문제 해결을 위한 Flex 설정 */
            display: flex;
            flex-direction: column;
        }

        /* 노치/하단 막대 제거 (이미지처럼 중앙 카드만 부드럽게 보이도록) */
        body.mobile-preview #mobile-shell-inner::before,
        body.mobile-preview #mobile-shell-inner::after {
            content: none;
        }

        /* 모바일 프리뷰 전용 플로팅 햄버거 버튼 (폰 안 우상단) */
        body.mobile-preview #mobile-menu-floating {
            position: absolute;
            top: 14px;
            right: 18px;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            cursor: pointer;
            z-index: 10;
        }

        body.mobile-preview #mobile-menu-floating span {
            display: block;
            width: 16px;
            height: 2px;
            border-radius: 999px;
            background: #1e293b;
        }

        body.mobile-preview #mobile-menu-floating span+span {
            margin-top: 3px;
        }

        /* 데스크탑 모드에서는 상단 Nav 쪽 버튼만 보이고, 모바일 모드에서는 폰 안 버튼만 보이게 */
        body.mobile-preview #mobile-menu-btn {
            display: none;
        }

        body:not(.mobile-preview) #mobile-menu-floating {
            display: none;
        }

        /* 모바일 프리뷰에서는 버거 메뉴 오버레이가 전체 배경을 어둡게 덮지 않도록 */
        body.mobile-preview #mobile-menu-panel {
            background: transparent;
            /* 모바일 프레임 안으로 제한하려면 추가 조정이 필요하지만, 
               현재 구조상 fixed라 전체 화면을 덮음. 
               일단 투명하게 해서 배경이 보이게 처리 */
        }

        body.mobile-preview main#main-content {
            max-width: 100%;
            padding: 18px 16px 24px;

            /* 1번 요청: 스크롤 문제 해결 */
            flex: 1;
            /* 남은 공간 모두 차지 */
            height: auto;
            max-height: none;
            /* 기존 제한 해제 */
            overflow-y: auto;
            /* 내부 스크롤 */
            overflow-x: hidden;

            /* 스크롤바 숨기기 (선택사항, 깔끔하게 보이려면) */
            /* Firefox */
            @supports (scrollbar-width: none) {
                scrollbar-width: none;
            }
            -ms-overflow-style: none;
            /* IE and Edge */

            background-color: transparent;
            /* 안쪽은 완전 투명, 바깥 글래스가 받쳐줌 */
        }

        /* Chrome, Safari, Opera 스크롤바 숨기기 */
        body.mobile-preview main#main-content::-webkit-scrollbar {
            display: none;
        }

        /* 모바일 프리뷰에서 러브트리 카드 영역들을 세로형(유튜브 스타일) 리스트로 표시 */
        body.mobile-preview #main-grid {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            /* 간격 조금 더 넓게 */
        }

        /* 3번, 4번 요청: 모바일 버전 가로 크기 맞춤 & 영상 위/설명 아래 */
        body.mobile-preview .tree-card {
            display: flex;
            flex-direction: column;
            /* 세로 배치 */
            width: 100%;
            height: auto;
            /* 높이 자동 */
            background: rgba(255, 255, 255, 0.6);
            /* 카드 자체도 약간 투명하게 */
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        body.mobile-preview .tree-card .aspect-video {
            width: 100%;
            /* 가로 꽉 차게 */
            min-width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            /* 16:9 비율 유지 */
        }

        body.mobile-preview .tree-card>.p-5 {
            flex: 1;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* 최근 방문한 트리 영역도 세로형 리스트로 */
        body.mobile-preview #my-trees-grid {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        body.mobile-preview #my-trees-grid>a {
            display: flex;
            flex-direction: column;
            /* 세로 배치 */
            width: 100%;
            height: auto;
            min-height: 180px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        body.mobile-preview #my-trees-grid>a>.h-2/3 {
            width: 100%;
            min-width: 100%;
            height: auto;
            aspect-ratio: 2 / 1;
            /* 적절한 비율 */
            padding: 16px;
        }

        body.mobile-preview #my-trees-grid>a>.h-1/3 {
            flex: 1;
            padding: 12px 16px;
            display: flex;
            flex-direction: row;
            /* 하단 정보는 가로로 */
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen font-sans text-slate-900 flex flex-col antialiased">

    <!-- Skip to main content for screen readers -->
    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-brand-500 text-white px-4 py-2 rounded-md z-50 animate-fade-in">메인
        콘텐츠로 건너뛰기</a>

    <!-- Loading indicator (initially hidden) -->
    <div id="loading-indicator" class="hidden fixed top-0 left-0 w-full h-1 bg-brand-500 z-50 animate-pulse">
        <div class="h-full bg-brand-600 animate-pulse"></div>
    </div>

    <!-- Nav -->
    <nav class="bg-white/80 backdrop-blur border-b border-slate-200 sticky top-0 z-40" role="navigation"
        aria-label="메인 네비게이션">
        <div id="nav-inner" class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-brand-500 rounded-full flex items-center justify-center text-white shadow-lg shadow-brand-500/30"
                    aria-hidden="true">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                        </path>
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span class="font-bold text-slate-900 leading-tight">Relovetree</span>
                    <span class="text-xs text-slate-500 leading-tight">나의 덕질 기록</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="mobile-menu-btn" type="button"
                    class="w-9 h-9 rounded-full bg-white/80 border border-slate-200 flex items-center justify-center shadow-sm hover:bg-slate-100"
                    onclick="toggleMobileMenu()" aria-label="메뉴 열기">
                    <span class="block w-4 h-[1.5px] bg-slate-700 rounded-full mb-1"></span>
                    <span class="block w-4 h-[1.5px] bg-slate-700 rounded-full mb-1"></span>
                    <span class="block w-4 h-[1.5px] bg-slate-700 rounded-full"></span>
                </button>
                <div class="flex items-center gap-2">
                    <!-- Login Button -->
                    <button id="login-btn"
                        class="px-4 py-2 bg-brand-500 text-white text-sm font-bold rounded-xl hover:bg-brand-600 transition-colors shadow-lg shadow-brand-500/30">
                        로그인
                    </button>

                    <!-- User Menu (Hidden by default) -->
                    <div id="user-menu" class="hidden flex items-center gap-3">
                        <a href="admin.html" id="admin-link"
                            class="hidden text-sm font-bold text-slate-500 hover:text-brand-600">
                            관리자
                        </a>
                        <div
                            class="flex items-center gap-2 bg-white border border-slate-200 rounded-full pl-1 pr-3 py-1 shadow-sm">
                            <img id="user-avatar" src="" alt="Profile" class="w-6 h-6 rounded-full">
                            <span id="user-name" class="text-xs font-bold text-slate-700 max-w-[80px] truncate"></span>
                        </div>
                        <button id="logout-btn" class="text-xs text-slate-400 hover:text-red-500 font-medium">
                            로그아웃
                        </button>
                    </div>

                    <div class="w-px h-6 bg-slate-200 mx-1"></div>

                    <div class="flex items-center gap-2 bg-slate-100 p-1 rounded-lg">
                        <button onclick="setViewportMode('desktop')" id="viewport-desktop-btn"
                            class="px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-slate-800 text-white shadow-sm">
                            데스크탑
                        </button>
                        <button onclick="setViewportMode('mobile')" id="viewport-mobile-btn"
                            class="px-3 py-1.5 rounded-md text-sm font-medium text-slate-600 hover:text-slate-900 transition-all">
                            모바일
                        </button>
                    </div>

                    <!-- Settings Button -->
                    <button onclick="openSettingsModal()"
                        class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-all"
                        title="테마 설정">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 모바일용 햄버거 메뉴 패널 -->
    <div id="mobile-menu-panel" class="hidden fixed inset-0 z-50 bg-black/40 flex items-start justify-center pt-20">
        <div class="w-72 max-w-[90vw] bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden">
            <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
                <span class="text-sm font-bold text-slate-800">메뉴</span>
                <button type="button"
                    class="w-7 h-7 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-100"
                    onclick="toggleMobileMenu()" aria-label="메뉴 닫기">
                    <span class="text-lg leading-none">&times;</span>
                </button>
            </div>
            <nav class="py-2 text-sm text-slate-700">
                <button type="button" onclick="navigateToHome()"
                    class="w-full text-left px-4 py-2 hover:bg-slate-50">홈</button>
                <button type="button" onclick="scrollToMyTrees()"
                    class="w-full text-left px-4 py-2 hover:bg-slate-50">최근 방문한 트리</button>
                <button type="button" onclick="scrollToAllTrees()"
                    class="w-full text-left px-4 py-2 hover:bg-slate-50">모든 러브트리</button>
            </nav>
        </div>
    </div>

    <!-- Main Layout -->
    <div id="mobile-shell" class="flex-1 w-full">
        <div id="mobile-shell-inner">
            <button id="mobile-menu-floating" type="button" onclick="toggleMobileMenu()" aria-label="메뉴 열기">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 py-6 sm:py-8 flex gap-6 lg:gap-8"
                id="main-content">

                <!-- Sidebar (Ranking) -->
                <aside class="hidden lg:block w-64 shrink-0" role="complementary" aria-label="인기 러브트리 순위">
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 sticky top-24">
                        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"
                                aria-hidden="true">
                                <path
                                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            인기 러브트리
                        </h3>
                        <ul class="space-y-3" role="list" id="popular-artists-list">
                            <!-- Artists will be populated by JavaScript -->
                        </ul>
                    </div>
                </aside>

                <!-- Main Content -->
                <div class="flex-1">
                    <header class="mb-6 sm:mb-8">
                        <h1 class="text-responsive-xl font-bold text-slate-900 mb-2 animate-slide-up" id="page-title">나의
                            러브트리
                        </h1>
                        <p class="text-slate-500 text-lg animate-slide-up" id="page-subtitle">사랑에 빠진 모든 순간을
                            기록하세요.</p>
                    </header>

                    <!-- My Trees Section (Hidden by default) -->
                    <div id="my-trees-section" class="mb-8 hidden animate-fade-in">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="my-trees-title">최근 방문한 트리</span>
                        </h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6" id="my-trees-grid">
                            <!-- My Trees populated here -->
                        </div>
                    </div>

                    <h2 id="all-trees-title" class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                            </path>
                        </svg>
                        <span id="all-trees-title">모든 러브트리</span>
                    </h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6" id="main-grid">

                        <!-- Create Card -->
                        <button onclick="openCreateModal()"
                            class="rounded-2xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center gap-4 hover:border-brand-500 hover:bg-brand-50/50 transition-all group cursor-pointer focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 animate-scale-in min-h-[16rem]"
                            id="create-tree-btn" type="button" aria-describedby="create-tree-desc">
                            <div
                                class="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-brand-100 text-slate-400 group-hover:text-brand-500 transition-colors shadow-sm group-hover:shadow-md">
                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4">
                                    </path>
                                </svg>
                            </div>
                            <span class="font-semibold text-lg text-slate-600 group-hover:text-brand-600"
                                id="btn-create">새로운 트리
                                만들기</span>
                            <span class="sr-only" id="create-tree-desc">새로운 러브트리를 만드세요</span>
                        </button>

                        <!-- Artist Cards will be populated by JavaScript -->
                        <div id="artist-cards-container" class="contents">
                            <!-- Cards will be dynamically generated -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create Modal -->
    <dialog id="create-modal" class="p-0 w-[90vw] max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
        <div class="p-6">
            <h3 class="text-xl font-bold text-slate-900 mb-2" id="modal-title">누구의 팬이신가요?</h3>
            <p class="text-slate-500 text-sm mb-6" id="modal-desc">아티스트의 이름을 입력하여 새로운 여정을 시작하세요.</p>

            <form method="dialog" onsubmit="handleCreate(event)" novalidate>
                <div class="mb-6">
                    <label for="artist-name"
                        class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2"
                        id="label-name">아티스트 이름</label>
                    <input type="text" id="artist-name" name="artistName"
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"
                        placeholder="예: 뉴진스, 임영웅..." required maxlength="50" aria-describedby="artist-name-help">
                    <p id="artist-name-help" class="text-xs text-slate-400 mt-1">최대 50자까지 입력 가능합니다
                    </p>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeModal('create-modal')"
                        class="px-5 py-2.5 text-slate-600 font-medium hover:bg-slate-100 rounded-xl transition-colors"
                        id="btn-cancel">취소</button>
                    <button type="submit"
                        class="px-5 py-2.5 bg-brand-500 hover:bg-brand-600 text-white font-bold rounded-xl shadow-lg shadow-brand-500/30 transition-all transform hover:scale-105"
                        id="btn-start">시작하기</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Settings Modal -->
    <dialog id="settings-modal" class="p-0 w-[90vw] max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900">테마 설정</h3>
                <button onclick="closeModal('settings-modal')"
                    class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <div class="space-y-6">
                <!-- Presets -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">추천 배경</label>
                    <div class="grid grid-cols-3 gap-3">
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=2073&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="Beach">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="Space">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?q=80&w=2592&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="Nature">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2070&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="City">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2072&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="Sunset">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                        <button
                            onclick="setBackground('image', 'https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=2029&auto=format&fit=crop')"
                            class="aspect-video rounded-lg overflow-hidden border-2 border-transparent hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all relative group">
                            <img src="https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=200&auto=format&fit=crop"
                                class="w-full h-full object-cover" alt="Abstract">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors">
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Solid Colors -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">단색 배경</label>
                    <div class="flex gap-3 flex-wrap">
                        <button onclick="setBackground('color', '#f8fafc')"
                            class="w-10 h-10 rounded-full bg-slate-50 border border-slate-200 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="기본 (Slate 50)"></button>
                        <button onclick="setBackground('color', '#ffffff')"
                            class="w-10 h-10 rounded-full bg-white border border-slate-200 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="화이트"></button>
                        <button onclick="setBackground('color', '#1e293b')"
                            class="w-10 h-10 rounded-full bg-slate-800 border border-slate-600 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="다크"></button>
                        <button onclick="setBackground('color', '#fdf2f8')"
                            class="w-10 h-10 rounded-full bg-pink-50 border border-pink-200 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="핑크"></button>
                        <button onclick="setBackground('color', '#f0f9ff')"
                            class="w-10 h-10 rounded-full bg-sky-50 border border-sky-200 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="스카이"></button>
                        <button onclick="setBackground('color', '#f0fdf4')"
                            class="w-10 h-10 rounded-full bg-green-50 border border-green-200 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-brand-500"
                            title="그린"></button>
                    </div>
                </div>

                <!-- Custom URL -->
                <div>
                    <label for="custom-bg-url"
                        class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">이미지 주소 직접
                        입력</label>
                    <div class="flex gap-2">
                        <input type="url" id="custom-bg-url" placeholder="https://..."
                            class="flex-1 px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500 text-sm">
                        <button onclick="applyCustomBackground()"
                            class="px-4 py-2 bg-slate-800 text-white text-sm font-bold rounded-xl hover:bg-slate-700 transition-colors">적용</button>
                    </div>
                </div>

                <!-- Pro Upgrade -->
                <div class="pt-4 border-t border-slate-100 mb-4">
                    <div class="bg-gradient-to-r from-brand-500 to-pink-500 rounded-xl p-4 text-white shadow-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-lg">Pro 멤버십</h4>
                            <span class="bg-white/20 px-2 py-0.5 rounded text-xs font-bold">Best</span>
                        </div>
                        <p class="text-white/90 text-sm mb-3">무제한 트리 생성과 프리미엄 테마를 이용해보세요.</p>
                        <button onclick="handleProUpgrade()"
                            class="w-full py-2 bg-white text-brand-600 font-bold rounded-lg hover:bg-slate-50 transition-colors shadow-sm">
                            지금 업그레이드 (₩9,900)
                        </button>
                    </div>
                </div>

                <!-- Reset -->
                <div class="pt-4 border-t border-slate-100">
                    <button onclick="resetBackground()"
                        class="w-full py-3 text-slate-500 font-medium hover:text-brand-600 hover:bg-slate-50 rounded-xl transition-colors flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        초기화
                    </button>
                </div>
            </div>
        </div>
    </dialog>

    <!-- JavaScript Modules -->
    <script>
        const VIEWPORT_MODE_KEY = 'relovetree_viewport_mode';
        let viewportMode = 'desktop';

        function setViewportMode(mode) {
            if (mode !== 'desktop' && mode !== 'mobile') return;
            viewportMode = mode;

            const navInner = document.getElementById('nav-inner');
            const mainLayout = document.getElementById('main-content');
            const desktopBtn = document.getElementById('viewport-desktop-btn');
            const mobileBtn = document.getElementById('viewport-mobile-btn');
            const aside = document.querySelector('aside[aria-label="인기 러브트리 순위"]');

            const applyWidth = (el, isDesktop) => {
                if (!el) return;
                if (isDesktop) {
                    el.style.maxWidth = '72rem';
                    el.style.marginLeft = '';
                    el.style.marginRight = '';
                } else {
                    el.style.maxWidth = '430px';
                    el.style.marginLeft = 'auto';
                    el.style.marginRight = 'auto';
                }
            };

            const isDesktop = mode === 'desktop';

            applyWidth(navInner, isDesktop);
            applyWidth(mainLayout, isDesktop);

            // 데스크탑/모바일 프리뷰 모드 body 클래스 토글
            if (isDesktop) {
                document.body.classList.remove('mobile-preview');
            } else {
                document.body.classList.add('mobile-preview');
            }

            // 모바일 프리뷰 모드에서는 인기 러브트리 사이드바 숨김
            if (aside) {
                aside.style.display = isDesktop ? '' : 'none';
            }

            // 버튼 스타일 토글
            if (desktopBtn && mobileBtn) {
                if (isDesktop) {
                    desktopBtn.classList.add('bg-slate-800', 'text-white');
                    desktopBtn.classList.remove('bg-white', 'text-slate-600');
                    mobileBtn.classList.remove('bg-slate-800', 'text-white');
                    mobileBtn.classList.add('bg-white', 'text-slate-600');
                } else {
                    mobileBtn.classList.add('bg-slate-800', 'text-white');
                    mobileBtn.classList.remove('bg-white', 'text-slate-600');
                    desktopBtn.classList.remove('bg-slate-800', 'text-white');
                    desktopBtn.classList.add('bg-white', 'text-slate-600');
                }
            }

            // 사용자가 명시적으로 선택한 모드를 기억
            try {
                localStorage.setItem(VIEWPORT_MODE_KEY, mode);
            } catch (e) { }
        }

        window.addEventListener('load', () => {
            let initialMode = 'desktop';

            try {
                const saved = localStorage.getItem(VIEWPORT_MODE_KEY);
                if (saved === 'desktop' || saved === 'mobile') {
                    initialMode = saved;
                } else if (window.matchMedia && window.matchMedia('(max-width: 768px)').matches) {
                    // 실제 모바일 기기에서는 기본을 모바일 모드로
                    initialMode = 'mobile';
                }
            } catch (e) { }

            setViewportMode(initialMode);
        });
    </script>
    <script src="src/shared.js"></script>
    <script src="src/auth.js"></script>
    <script src="src/payment.js"></script>
    <script src="index.js"></script>
</body>

</html>